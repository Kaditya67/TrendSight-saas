{% extends "stocks/dashboard/base.html" %}

{% block title %} Stocks {% endblock %}

{% block content %}
<style>
    /* Custom scrollbar styles */
    ::-webkit-scrollbar {
        width: 8px;
        height: 8px; /* For horizontal scrollbars */
    }

    ::-webkit-scrollbar-thumb {
        background-color: rgba(0, 0, 0, 0.2);
        border-radius: 10px;
        border: 2px solid transparent; /* Adds a small border to the thumb for contrast */
        background-clip: content-box;
        transition: background-color 0.3s ease;
    }

    ::-webkit-scrollbar-thumb:hover {
        background-color: rgba(0, 0, 0, 0.4); /* Darker color on hover */
    }

    ::-webkit-scrollbar-track {
        background-color: rgba(0, 0, 0, 0.1);
        border-radius: 10px;
    }

    /* For smooth scrolling effect */
    html {
        scroll-behavior: smooth;
    }
</style>

<div class="container mx-auto my-8">
    <!-- Header Section -->
    <div class="text-center mb-12">
        <h1 class="text-4xl font-bold text-gray-700">Nifty 50 Dashboard</h1>
        <p class="text-lg text-gray-500">Track key EMA trends and broader market insights</p>
    </div> 
    
    <!-- EMA Trend Analysis (Scrollable) -->
    <div class="mb-12">
        <h5 class="text-2xl font-bold text-gray-800 mb-4">
            Nifty 50 EMA Trends <span class="text-sm font-medium text-gray-500">(in days)</span>
        </h5>
        <div class="flex overflow-x-auto space-x-4 px-2 py-4 rounded-lg shadow-inner">
            <!-- EMA 10 Card -->
            <div class="card border border-gray-300 shadow-md rounded-lg p-4 text-left hover:shadow-xl hover:bg-blue-100 transition-all min-w-[150px] font-bold bg-gradient-to-r from-blue-50 to-white">
                <div class="flex items-center justify-between mb-2">
                    <p class="text-sm text-gray-600">10 EMA</p>
                </div>
                <span class="text-green-600 text-sm">+3 days</span>
            </div>
            <!-- EMA 20 Card -->
            <div class="card border border-gray-300 shadow-md rounded-lg p-4 text-left hover:shadow-xl hover:bg-red-100 transition-all min-w-[150px] font-bold bg-gradient-to-r from-red-50 to-white">
                <div class="flex items-center justify-between mb-2">
                    <p class="text-sm text-gray-600">20 EMA</p>
                </div>
                <span class="text-red-600 text-sm">-2 days</span>
            </div>
            <!-- EMA 30 Card -->
            <div class="card border border-gray-300 shadow-md rounded-lg p-4 text-left hover:shadow-xl hover:bg-blue-100 transition-all min-w-[150px] font-bold bg-gradient-to-r from-blue-50 to-white">
                <div class="flex items-center justify-between mb-2">
                    <p class="text-sm text-gray-600">30 EMA</p>
                </div>
                <span class="text-green-600 text-sm">+5 days</span>
            </div>
            <!-- EMA 50 Card -->
            <div class="card border border-gray-300 shadow-md rounded-lg p-4 text-left hover:shadow-xl hover:bg-blue-100 transition-all min-w-[150px] font-bold bg-gradient-to-r from-blue-50 to-white">
                <div class="flex items-center justify-between mb-2">
                    <p class="text-sm text-gray-600">50 EMA</p>
                </div>
                <span class="text-green-600 text-sm">+8 days</span>
            </div>
            <!-- EMA 100 Card -->
            <div class="card border border-gray-300 shadow-md rounded-lg p-4 text-left hover:shadow-xl hover:bg-blue-100 transition-all min-w-[150px] font-bold bg-gradient-to-r from-blue-50 to-white">
                <div class="flex items-center justify-between mb-2">
                    <p class="text-sm text-gray-600">100 EMA</p>
                </div>
                <span class="text-green-600 text-sm">+12 days</span>
            </div>
            <!-- EMA 200 Card -->
            <div class="card border border-gray-300 shadow-md rounded-lg p-4 text-left hover:shadow-xl hover:bg-red-100 transition-all min-w-[150px] font-bold bg-gradient-to-r from-red-50 to-white">
                <div class="flex items-center justify-between mb-2">
                    <p class="text-sm text-gray-600">200 EMA</p>
                </div>
                <span class="text-red-600 text-lg">-15 days</span>
            </div>
        </div>
    </div>

    <style>
        .chartWrapper {
            width: 100%; /* Ensure the wrapper takes full width */
            overflow-x: auto; /* Enable horizontal scrolling */
            display: flex; /* Align the chart correctly */
        }
    
        .chartAreaWrapper {
            flex-shrink: 0; /* Prevent shrinking of the chart */
        }
    
        #sectorChart {
            height: 400px; /* Adjust height for better visibility */
        }
    </style>
    
    <!-- Graph Section -->
    <div class="mb-12">
        <h5 class="text-2xl font-bold text-gray-800 mb-4">Day Counts by Sector</h5>
        <!-- Scrollable container for the chart -->
        <div class="chartWrapper">
            <!-- Canvas will stretch to accommodate more sectors, and it's scrollable horizontally -->
            <div class="chartAreaWrapper">
                <canvas id="sectorChart"></canvas>
            </div>
        </div>
    </div>
    
    <!-- Include Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Static data for sectors and days (extended dataset)
        const sectorData = {
            labels: [
                'IT', 'Finance', 'Energy', 'Pharma', 'Auto', 'FMCG', 'Realty', 'Metals', 'Media', 'Infra', 'Chemical', 'Retail',
                'Construction', 'Telecom', 'Agri', 'Education', 'Healthcare', 'Logistics', 'Textiles', 'Tourism', 'Entertainment',
                'Aerospace', 'Shipping', 'Automotive', 'Technology', 'Manufacturing', 'Food & Beverages', 'Mining', 'Biotech', 
                'Agriculture', 'Government'
            ],
            datasets: [
                {
                    label: 'Days',
                    backgroundColor: function(context) {
                        const value = context.raw;
                        return value > 0 ? 'rgba(34, 197, 94, 0.7)' : 'rgba(239, 68, 68, 0.7)'; // Green for positive, red for negative
                    },
                    borderColor: function(context) {
                        const value = context.raw;
                        return value > 0 ? 'rgba(34, 197, 94, 1)' : 'rgba(239, 68, 68, 1)';
                    },
                    borderWidth: 1,
                    data: [5, -2, 4, -4, 7, -3, 2, 9, -2, 6, -5, 3, 4, -2, 1, 5, -3, 2, -1, 4, 3, 7, 1, -2, 6, 4, 3, -1, 0, 2], // Extended data for more sectors
                },
            ],
        };
    
        // Dynamically calculate the width based on number of sectors
        const sectorCount = sectorData.labels.length;
        const widthPerSector = 110; // Width per sector in pixels
        const chartWidth = sectorCount * widthPerSector;
    
        // Chart configuration
        const config = {
            type: 'bar',
            data: sectorData,
            options: {
                responsive: true,
                maintainAspectRatio: false, // Allow the chart to resize on mobile
                plugins: {
                    legend: {
                        display: false, // No legend since there is only one dataset
                    },
                },
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'Sectors',
                            font: {
                                size: 14,
                                weight: 'bold',
                            },
                        },
                        ticks: {
                            font: {
                                size: 12,
                            },
                            autoSkip: true, // Skip some labels for better readability
                            maxRotation: 45, // Rotate the labels for better fit
                        },
                        barPercentage: 0.6, // Moderate bar width
                        categoryPercentage: 0.8, // Space between bars
                        maxBarThickness: 50,
                    },
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Days',
                            font: {
                                size: 14,
                                weight: 'bold',
                            },
                        },
                        ticks: {
                            font: {
                                size: 12,
                            },
                        },
                    },
                },
            },
        };
    
        // Render chart
        const ctx = document.getElementById('sectorChart').getContext('2d');
        new Chart(ctx, config);
    
        // Dynamically set the width of the chartAreaWrapper
        document.querySelector('.chartAreaWrapper').style.width = `${chartWidth}px`;
    </script>

    <!-- Broader Market Trend Table (Scrollable) -->
    <div class="mb-6">
        <label for="search" class="sr-only">Search</label>
        <div class="relative max-w-xs">
            <input type="text" id="search" placeholder="Search by index..." class="block w-full p-3 pl-10 pr-4 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" />
            <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="h-5 w-5">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 18a8 8 0 100-16 8 8 0 000 16zM21 21l-4.35-4.35" />
                </svg>
            </span>
        </div>
    </div>
    <div class="card shadow-lg rounded-lg bg-white p-4">
        <h5 class="text-2xl font-semibold text-gray-800 mb-6 text-left">Sectoral Indices Trends - Daily</h5>

        <div class="overflow-x-auto"> <!-- Enables horizontal scrolling -->
            <table class="min-w-full table-auto border-collapse text-sm text-left">
                <thead>
                    <tr class="bg-gray-800">
                        <th class="py-3 px-4 font-medium text-gray-100 border border-gray-300 whitespace-nowrap">Index</th>
                        <th class="py-3 px-4 font-medium text-gray-100 border border-gray-300 whitespace-nowrap">10 EMA</th>
                        <th class="py-3 px-4 font-medium text-gray-100 border border-gray-300 whitespace-nowrap">20 EMA</th>
                        <th class="py-3 px-4 font-medium text-gray-100 border border-gray-300 whitespace-nowrap">30 EMA</th>
                        <th class="py-3 px-4 font-medium text-gray-100 border border-gray-300 whitespace-nowrap">50 EMA</th>
                        <th class="py-3 px-4 font-medium text-gray-100 border border-gray-300 whitespace-nowrap">100 EMA</th>
                        <th class="py-3 px-4 font-medium text-gray-100 border border-gray-300 whitespace-nowrap">200 EMA</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="hover:bg-gray-50 transition-all duration-300">
                        <td class="py-3 px-4 border border-gray-300 font-medium text-gray-700">Nifty 1</td>
                        <td class="py-3 px-4 border border-gray-300 font-bold text-green-600">+3 &#8593;</td>
                        <td class="py-3 px-4 border border-gray-300 font-bold text-red-600">-2 &#8595;</td>
                        <td class="py-3 px-4 border border-gray-300 font-bold text-green-600">+5 &#8593;</td>
                        <td class="py-3 px-4 border border-gray-300 font-bold text-green-600">+8 &#8593;</td>
                        <td class="py-3 px-4 border border-gray-300 font-bold text-green-600">+12 &#8593;</td>
                        <td class="py-3 px-4 border border-gray-300 font-bold text-red-600">-15 &#8595;</td>
                    </tr>
                    <!-- Repeat the rows as needed -->
                </tbody>
            </table>
        </div>
    </div>
{% endblock %}
